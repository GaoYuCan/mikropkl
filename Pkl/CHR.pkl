module CHR
import "Utils.pkl"

typealias RouterOSReleaseChannel =  ("stable"|"long-term"|"testing"|"development"|"upgrade")
typealias RouterOSReleaseProduct = ("routeros"|"chr")
typealias RouterOSReleaseArch = ("x86"|"arm64")
typealias RouterOSReleaseImageType = ("img.zip"|"npk")

/*
https://download.mikrotik.com/routeros/7.18/routeros-7.18-arm.npk
https://download.mikrotik.com/routeros/7.18/routeros-7.18-arm64.npk
https://download.mikrotik.com/routeros/7.18/chr-7.18.img.zip
https://download.mikrotik.com/routeros/7.18/chr-7.18-arm64.img.zip
*/

class RouterOSVersion {
    name: String|RouterOSReleaseChannel
    arch: RouterOSReleaseArch
    product: RouterOSReleaseProduct = "chr"
    downloadUrl = new Utils.URLDownload {
        name = "\(product)-\(_name).\(_imageType)"
        url = "https://download.mikrotik.com/routeros/\(_name)/\(product)-\(_name)\(_arch).\(_imageType)"
        filename = "\(product)-\(_name)\(_arch).img"
    }
    _imageType: RouterOSReleaseImageType = if (product == "chr") "img.zip" else "npk" 
    _arch: String = if (arch == "x86" && product == "chr") "" else "-\(arch)"
    _name: String = if (name is RouterOSReleaseChannel) getNameFromChannel(name) else name
    function getNameFromChannel(releaseChannelName : RouterOSReleaseChannel) : String = read("https://upgrade.mikrotik.com/routeros/NEWESTa7.\(releaseChannelName)").text.split(" ")[0]
}

class MikrotikIcon extends Utils.SVG {
    name: String = "mikrotik.svg"
    text: String = if (style == null) read(url).text else if (style == "line") svgLine(fill) else svgSolid(fill) 
    style: "solid"|"line"? = null
    fill: String? = "#00ff00"
    // default: https://mikrotik.com/logo/library/logo/SVG/MT_Symbol_Line_Black.svg
    source: String = "mikrotik.com" 
    group: String = "logo/library/logo/SVG"
    tag: String = "MT_Symbol_Line_Black"
    url: String = "https://\(source)/\(group)/\(tag).svg" 
    function svgSolid(fill: String?) = 
    """
    <?xml version="1.0" encoding="UTF-8"?>
    <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41.83 44.62">
        <g id="Layer_1-2">
            <path
                d="M41.83,13.83c0-1.77-.96-3.4-2.5-4.26L23.3.62c-1.48-.83-3.28-.83-4.76,0L2.5,9.57c-1.54.86-2.5,2.49-2.5,4.26v17.08c0,1.78.97,3.42,2.53,4.28l16.04,8.82c1.46.81,3.24.81,4.7,0l16.04-8.82c1.56-.86,2.53-2.5,2.53-4.28V13.83ZM12.03,30.78c0,.4-.43.65-.78.46l-2.68-1.48c-.56-.31-.9-.89-.9-1.53v-8.07c0-.4.43-.65.78-.46l2.95,1.63c.39.21.63.62.63,1.07v8.38ZM34.16,28.19c0,.63-.34,1.22-.9,1.53l-2.68,1.48c-.35.19-.78-.06-.78-.46v-10.32c0-.4-.43-.65-.78-.46l-4.95,2.73c-.56.31-.9.89-.9,1.53v10.55c0,.32-.17.61-.45.76l-1.01.56c-.52.29-1.16.29-1.69,0l-.94-.52c-.28-.15-.45-.45-.45-.76v-10.66c0-.63-.34-1.22-.9-1.53l-9.81-5.42c-.17-.09-.27-.27-.27-.46v-.42c0-.63.34-1.22.9-1.53l1.4-.77c.52-.29,1.16-.29,1.69,0l8.48,4.69c.52.29,1.16.29,1.69,0l3.81-2.11c.36-.2.36-.72,0-.92l-8.51-4.7c-.36-.2-.36-.72,0-.92l2.9-1.6c.52-.29,1.16-.29,1.69,0l11.55,6.38c.56.31.9.89.9,1.53v11.81Z"
                style="fill:\(fill ?? "#0e0e10"); stroke-width:0px;" />
        </g>
    </svg>
    """
    function svgLine(fill: String?) =
    """
    <?xml version="1.0" encoding="UTF-8"?>
    <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41.83 44.62">
        <g id="Layer_1-2">
            <path
                d="M11.71,21.59c-.09-.1-.19-.19-.31-.26l-2.95-1.63c-.11-.06-.22-.07-.32-.05-.27-.02-.53.18-.53.48v7.99c0,.72.39,1.39,1.03,1.74l2.7,1.48c.33.18.73-.06.73-.43v-8.58c0-.29-.13-.55-.34-.74Z"
                style="fill:\(fill ?? "#0e0e10"); stroke-width:0px;" />
            <path
                d="M33.21,14.78l-10.19-5.58-1.31-.72c-.52-.29-1.16-.29-1.69,0l-2.9,1.6c-.1.05-.16.13-.21.22-.17.23-.12.57.15.72l8.62,4.72c.3.22.29.68-.05.87l-3.81,2.11c-.52.29-1.16.29-1.69,0l-8.48-4.69c-.52-.29-1.16-.29-1.69,0l-1.4.77c-.28.16-.51.39-.66.65-.2.31-.32.68-.32,1.06v.52l6.44,3.53,3.73,2.06s.06.05.09.07c.09.06.17.12.25.19.24.23.4.52.5.83.04.14.06.29.06.44v10.66c0,.26.12.49.31.66.07.08.15.14.24.2l.76.42c.59.33,1.31.33,1.91,0l.76-.42c.17-.09.31-.24.39-.41.1-.14.15-.31.15-.49v-10.55c0-.63.34-1.22.9-1.53l4.95-2.73c.32-.18.7.03.75.38v10.57c0,.38.4.62.73.43l2.7-1.48c.64-.35,1.03-1.02,1.03-1.74v-11.61c0-.72-.4-1.39-1.03-1.74Z"
                style="fill:\(fill ?? "#0e0e10"); stroke-width:0px;" />
            <path
                d="M39.33,9.57L23.3.62c-1.48-.83-3.28-.83-4.76,0L2.5,9.57c-1.54.86-2.5,2.49-2.5,4.26v17.08c0,1.78.97,3.42,2.53,4.28l16.04,8.82c1.46.81,3.24.81,4.7,0l16.04-8.82c1.56-.86,2.53-2.5,2.53-4.28V13.83c0-1.77-.96-3.4-2.5-4.26ZM36.95,32.33l-15.01,8.26c-.64.35-1.41.35-2.05,0l-15.01-8.26c-.68-.37-1.1-1.09-1.1-1.86V14.27c0-.77.42-1.48,1.09-1.86l15.01-8.38c.64-.36,1.43-.36,2.07,0l15.01,8.38c.67.38,1.09,1.09,1.09,1.86v16.2c0,.78-.42,1.49-1.1,1.86Z"
                style="fill:\(fill ?? "#0e0e10"); stroke-width:0px;" />
        </g>
    </svg>
    """
    hidden fixed black = "#0E0E10"
    hidden fixed gray = "#707372"
    hidden fixed light = "#C8C8C7"
    hidden fixed avacadoLight = "#A3D16E"
    hidden fixed avacadoDark = "#155757"
    hidden fixed purpleLight = "#C33366"
    hidden fixed purpleDark = "#692878"
    hidden fixed seaBlueLight = "#87D3DB"
    hidden fixed seaBlueDark = "#1F417A"
}

