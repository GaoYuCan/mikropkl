// Helper script to output RouterOS version as string 
//   from a "release channel name" like "stable" or "testing".

// For use from shell: `pkl eval ./Pkl/chr.version.pkl`
// default is stable/x86, use env vars to change: 
//   UTM_ARCHITECTURE=aarch64 CHR_VERSION=7.18.1 pkl eval ./Pkl/chr.version.pkl

import "CHR.pkl"

function getVersionStringFromChannelName(channel : String, arch: String) : String = new CHR.RouterOSVersion { 
  name = channel
  arch = arch
}.version

hidden channel : String = read?("env:CHR_VERSION") ?? "stable"
hidden arch : String = read?("env:UTM_ARCHITECTURE") ?? "x86_64"

output {
  text = getVersionStringFromChannelName(channel, arch).trim()
}
